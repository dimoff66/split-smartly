"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=(t,s)=>({brackets:[],mentions:[],ignoreInsideQuotes:!0,includeSeparatorMode:"NONE",ignoreCase:!0,trimResult:!0,trimSeparators:!1,check:void 0,defaultBrackets:[["(",")"],["[","]"],["{","}"]],...s,separators:t,init(){if(Array.isArray(this.mentions)||"string"==typeof this.mentions){const e=[this.mentions].flat().filter(Boolean).reduce(((e,t)=>(e[this.ignoreCase?t.toUpperCase():t]=t,e)),{});this.mentions=!o(e)&&e}return this.createBracketsMap().createBracketsSearch().createSeparatorsSearch()},merge(e){return e?(e={...this,...e},["brackets","mentions"].some((t=>t in e))&&e.init(),e):this},arrayToPattern(t){e.screenedSymbols=e.screenedSymbols||new Set(".{}[]^()+*?\\/$|".split(""));const{screenedSymbols:s}=e;return t.map((e=>e.split("").map((e=>s.has(e)?"\\"+e:e)).join(""))).join("|")},createRegExp:e=>RegExp(e,"g"),createBracketsMap(){let{brackets:e=[],ignoreInsideQuotes:t}=this;return!0===e?e=this.defaultBrackets:"object"!=typeof e||Array.isArray(e)?"string"==typeof e&&(e=e.split(",").map((e=>{let t=e.trim().split(" ");if(2!==t.length){if(2!==h(t).length)throw new Error("open and close parts of brackets should be separated by space symbol");t=h(t).split("")}return t}))):e=Object.entries(e),t&&e.unshift(["'",,,!0],['"',,,!0]),this.bracketsMap=e.reduce(((e,[t,s,...r])=>{1!==r.length||this.searchWithin||r.unshift(void 0);let[i=this.searchWithin&&1,n]=r;return"number"==typeof i&&(i=[i]),e[t]={open:t,ignoreMode:n,searchLevels:i,close:s||t},e}),{}),this},createBracketsSearch(){const e=Object.entries(this.bracketsMap).flatMap((([,{close:e,open:t}])=>e!==t?[t,e]:t)).concat(Object.keys(this.mentions||{})).filter(Boolean),t=this.arrayToPattern(e);return this.bracketsSearch=this.createRegExp(t),this},createSeparatorsSearch(){const{separators:e}=this;if("string"==typeof e||Array.isArray(e)){const t=this.arrayToPattern([e].flat().filter(Boolean));this.separatorSearch=this.createRegExp(t)}else e?(this.separatorSearch=e,this.ignoreCase=e.ignoreCase):this.separatorSearch=/empty/;return this}}.init());e.screenedSymbols=void 0;const t=(e,t)=>{if(3===e.length){if(!t)return e}else if(1===e.length){const t=h(e);"string"==typeof t?e.push(",",{}):Array.isArray(t)?(e.unshift(null),e.push({})):"object"==typeof t&&e.unshift(null,",")}else if(2===e.length)"string"==typeof e[1]||Array.isArray(e[1])?e.push({}):e.unshift(null);else if(e.length>3)throw new Error("Too much arguments passed to splitSmartly function!!!");return t&&(e[2]={...e[2],...t}),e};function s(...s){let[r,n,a]=t(s);const o=e(n,a),h=i(o);return null!==r?h(r):h}function r(e,t){const s=this.merge(t);let r=new n(e,s);return"number"==typeof s.indexes?r.getNext():s.returnIterator?r:r.getAll()}s.searchWithin=(...e)=>(1===e.length&&("string"==typeof e[0]?e.push(null,{}):e.unshift(null)),"object"==typeof e[1]&&e[1].brackets||(e[1]={brackets:e[1]}),e.splice(1,0,null),s(...t(e,{searchWithin:!0}))),s.search=(...e)=>s(...t(e,{includeSeparatorMode:"ONLY"}));const i=e=>{const t=r.bind(e);return Object.assign(t,{getOne(e,s,r={}){if(isNaN(s))throw new Error("second parameter of `getOne` function should be index");return t(e,{...r,indexes:s})},getFirst:(e,s={})=>t(e,{...s,indexes:0}),getIndexes(e,s,r={}){if(!Array.isArray(s))throw new Error("second parameter of `getOne` function should be array of indexes");return t(e,{...r,indexes:s})},getIterator:(e,s={})=>t(e,{...s,returnIterator:!0})})};class n{constructor(e,t){this.string=e,this.searchSettings=t,this.prepareSearch()}prepareSearch(){const{separatorSearch:e,bracketsSearch:t,indexes:s}=this.searchSettings,r=[s].flat().filter(Boolean);for(const s of[e,t])s.lastIndex=0;Object.assign(this,{brackets:[],pipe:[],currentMentions:[],position:0,isDone:!1,freeArea:{start:0,end:void 0},lastSeparator:void 0,searchString:this.searchSettings.ignoreCase&&!this.searchSettings.separatorSearch.ignoreCase?this.string.toUpperCase():this.string,indexes:!o(r)&&{values:new Set(r),max:Math.max(...r),count:0,hasIndex(){return-Infinity===this.max||this.values.has(this.count++)},isOverMax(){return-Infinity!==this.max&&this.count>this.max}}})}get pipeIsEmpty(){return o(this.pipe)}getMentions(e,t){const s=[],r=[];for(const i of this.currentMentions)i.index>=e&&i.index<t?s.push(i.mention):r.push(i);return[s.length&&s,r]}trimResultText(e){return this.searchSettings.trimResult?e.trim():e}trimSeparatorText(e){return this.searchSettings.trimSeparators?e.trim():e}checkSeparator(e){const{string:t}=this,{check:s,includePositions:r,mentions:i}=this.searchSettings;let{0:n="",index:o=t.length,searchWithinData:h}=e||{};const c=n.length,p=h?h.openPosition:this.position;let l=t.substring(p,o);n||(this.isDone=!0),l=this.trimResultText(l),n=this.trimSeparatorText(n);let u,g=h?[h.open,h.close]:n;if(r&&(l={text:l,position:p},g={text:g,position:o,isSeparator:!0}),i){l="string"==typeof l?{text:l}:l;const[e,t]=this.getMentions(p,o);e&&(l.mentions=e,u=t)}if(s&&n){const e=isNaN(this.tempPosition)?p:this.tempPosition;this.tempPosition=o+n.length;const r=this;if(!s({getString:a((()=>r.trimResultText(t.substring(e,o)))),getTextAfter:a((()=>t.substring(o+n.length))),getMentions:a((()=>r.getMentions(e,o)[0])),getSeparator:a((()=>n)),get string(){return this.getString()},get textAfter(){return this.getTextAfter()},get mentions(){return this.getMentions()},get separator(){return this.getSeparator()}}))return[];delete this.tempPosition}return u&&(this.currentMentions=u),this.position=o+c,[l,g,!0]}pushToPipe(e){if(this.indexes){if(!this.indexes.hasIndex())return;this.indexes.isOverMax()&&(this.isDone=!0)}this.pipe.push(e)}addToPipe(e){let[t,s,r]=this.checkSeparator(e);if(!r)return!1;switch(this.searchSettings.includeSeparatorMode){case l:this.pushToPipe(t),s&&this.pushToPipe(s);break;case u:this.pushToPipe([t,s]);break;case g:!("object"==typeof t?t.text:t)&&!this.lastSeparator||this.pushToPipe([this.lastSeparator,t]),this.lastSeparator=s;break;case d:s&&this.pushToPipe(s);break;default:this.pushToPipe(t)}return!this.pipeIsEmpty}findBrackets(){const{searchString:e,brackets:t,freeArea:s,searchSettings:r}=this,{bracketsSearch:i,separatorSearch:n,searchWithin:a}=r,h=a?()=>this.pipeIsEmpty:()=>!s.end;for(;h();){var p;const h=i.exec(e);if(!h){if(a||isNaN(s.start))return!1;s.end=e.length-1;continue}const l=h[0],{close:u,ignoreMode:g,searchLevels:d}=c(t)||{};let f;switch((l===u?1:g&&4)||(f=r.bracketsMap[l])&&2||(null==(p=r.mentions)?void 0:p[l])&&3){case 1:const e=t.pop();a?(!0===d||d.includes(t.length+1))&&this.addToPipe(Object.assign(h,{searchWithinData:e})):o(t)&&(s.start=h.index,n&&n.lastIndex<s.start&&(n.lastIndex=s.start));break;case 2:t.push({...f,openPosition:h.index+l.length}),1!==t.length||a||(s.end=h.index);break;case 3:this.currentMentions.push({mention:r.mentions[l],index:h.index})}}return!0}findSeparator(e){const{searchString:t,freeArea:s}=this,{separatorSearch:r}=this.searchSettings;let i;for(;!i;){if(e=e||r.exec(t))if(e.index<=s.end){const t=e.index>=s.start&&this.addToPipe(e);if(e=null,!t)continue}else s.start=s.end=void 0;else this.addToPipe();i=!0}return e}getNext(){let e;for(;this.pipeIsEmpty&&!this.isDone;)this.findBrackets()?this.searchSettings.searchWithin||(e=this.findSeparator(e)):this.isDone=!0;return this.pipeIsEmpty?null:this.pipe.shift()}getAll(){return[...this]}getRest(){const e=[];let t;for(;null!==(t=this.getNext());)e.push(t);return e}*[Symbol.iterator](){this.prepareSearch();const e=this;let t;do{t=e.getNext(),null!==t&&(yield t)}while(null!==t)}}const a=e=>{let t,s;return function(...r){return s||(t=e(...r),s=!0),t}},o=e=>{if(!e)return!0;if(Array.isArray(e)){if(0===e.length)return!0}else if("object"==typeof e&&0===Object.keys(e).length)return!0;return!1},h=e=>e[0],c=e=>e[e.length-1];var p;exports.EnumIncludeSeparatorMode=void 0,(p=exports.EnumIncludeSeparatorMode||(exports.EnumIncludeSeparatorMode={})).INCLUDE_SEPARATOR_NONE="NONE",p.INCLUDE_SEPARATOR_SEPARATELY="SEPARATELY",p.INCLUDE_SEPARATOR_LEFT="LEFT",p.INCLUDE_SEPARATOR_RIGHT="RIGHT",p.INCLUDE_SEPARATOR_ONLY="ONLY";const l="SEPARATELY",u="LEFT",g="RIGHT",d="ONLY";exports.INCLUDE_SEPARATOR_LEFT=u,exports.INCLUDE_SEPARATOR_NONE="NONE",exports.INCLUDE_SEPARATOR_ONLY=d,exports.INCLUDE_SEPARATOR_RIGHT=g,exports.INCLUDE_SEPARATOR_SEPARATELY=l,exports.SearchResults=n,exports.createSplitFunction=i,exports.default=s,exports.splitSmartly=s;
//# sourceMappingURL=split-smartly.cjs.production.min.js.map
